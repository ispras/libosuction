arch i686 targets armv7l:armv7l
arch x86_64 targets armv7l:armv7l

mkpriv-run0
  targettype 32bit block!
  autoreqprov off
  +/
  requires "qemu-accel-#QA_VERSION#"
  post "RUN=0"
  post "GCC_VERSION=#GCC_VERSION#"
  post "TARGET_ARCH=#TARGET_ARCH#"
  post "WRAPDIR=#WRAPDIR#"
  post "for i in gcc g++ cpp c++; do"
  post "  if [ -f /emul/usr/bin/$i ]; then"
  post "    cp /emul/usr/bin/$i /emul/usr/bin/$i-real"
  post "    cp /emul/usr/bin/$i-real /emul/usr/bin/$TARGET_ARCH-$i-real"
  post "    cp $WRAPDIR/gcc-wrapper-$RUN /emul/usr/bin/$i"
  post "  else"
  post "    echo "Not found: /emul/usr/bin/$i. Ignoring...""
  post "  fi"
  post "done"
  post "cp /emul/usr/bin/gcc-real /emul/usr/bin/cc-real"
  post "cp /emul/usr/bin/g++-real /emul/usr/bin/c++-real"
  post "mkdir -p /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc"
  post "cp /emul/usr/bin/gcc-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  post "cp /emul/usr/bin/g++-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"
  preun "for i in gcc g++ cpp c++; do"
  preun "  mv /emul/usr/bin/$i-real /emul/usr/bin/$i"
  preun "  rm /emul/usr/bin/$TARGET_ARCH-$i-real"
  preun "done"
  preun "rm /emul/usr/bin/cc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"

mkpriv-run1
  targettype 32bit block!
  autoreqprov off
  +/
  requires "qemu-accel-#QA_VERSION#"
  post "RUN=1"
  post "GCC_VERSION=#GCC_VERSION#"
  post "TARGET_ARCH=#TARGET_ARCH#"
  post "WRAPDIR=#WRAPDIR#"
  post "PLUGDIR=#PLUGDIR#"
  post "for i in gcc g++ cpp c++; do"
  post "  if [ -f /emul/usr/bin/$i ]; then"
  post "    cp /emul/usr/bin/$i /emul/usr/bin/$i-real"
  post "    cp /emul/usr/bin/$i-real /emul/usr/bin/$TARGET_ARCH-$i-real"
  post "    cp $WRAPDIR/gcc-wrapper-$RUN /emul/usr/bin/$i"
  post "  else"
  post "    echo "Not found: /emul/usr/bin/$i. Ignoring...""
  post "  fi"
  post "done"
  post "cp /emul/usr/bin/gcc-real /emul/usr/bin/cc-real"
  post "cp /emul/usr/bin/g++-real /emul/usr/bin/c++-real"
  post "mkdir -p /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc"
  post "cp /emul/usr/bin/gcc-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  post "cp /emul/usr/bin/g++-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"
  post "for i in ld ld.bfd ld.gold; do"
  post "  mv /emul/usr/bin/$i $PLUGDIR/ld/$i"
  post "  cp $WRAPDIR/wrapper-$RUN /emul/usr/bin/$i"
  post "done"
  post "#rm /tmp/gccwrap/ld/ld"
  post "#printf "%s\n%s\n" '#!/bin/bash' 'if [ -f /home/abuild/rpmbuild/SOURCES/linaro-glibc.spec ]; then $0.bfd "$@"; else $0.gold "$@" || $0.bfd "$@"; fi' > /tmp/gccwrap/ld/ld"
  post "#chmod +x /tmp/gccwrap/ld/ld"
  preun "for i in gcc g++ cpp c++; do"
  preun "  mv /emul/usr/bin/$i-real /emul/usr/bin/$i"
  preun "  rm /emul/usr/bin/$TARGET_ARCH-$i-real"
  preun "done"
  preun "rm /emul/usr/bin/cc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"
  preun "for i in ld ld.bfd ld.gold; do"
  preun "  mv $PLUGDIR/ld/$i /emul/usr/bin/$i"
  preun "done"

mkpriv-run2
  targettype 32bit block!
  autoreqprov off
  +/
  requires "qemu-accel-#QA_VERSION#"
  post "RUN=2"
  post "GCC_VERSION=#GCC_VERSION#"
  post "TARGET_ARCH=#TARGET_ARCH#"
  post "WRAPDIR=#WRAPDIR#"
  post "PLUGDIR=#PLUGDIR#"
  post "for i in gcc g++ cpp c++; do"
  post "  if [ -f /emul/usr/bin/$i ]; then"
  post "    cp /emul/usr/bin/$i /emul/usr/bin/$i-real"
  post "    cp /emul/usr/bin/$i-real /emul/usr/bin/$TARGET_ARCH-$i-real"
  post "    cp $WRAPDIR/gcc-wrapper-$RUN /emul/usr/bin/$i"
  post "  else"
  post "    echo "Not found: /emul/usr/bin/$i. Ignoring...""
  post "  fi"
  post "done"
  post "cp /emul/usr/bin/gcc-real /emul/usr/bin/cc-real"
  post "cp /emul/usr/bin/g++-real /emul/usr/bin/c++-real"
  post "mkdir -p /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc"
  post "cp /emul/usr/bin/gcc-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  post "cp /emul/usr/bin/g++-real /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"
  post "for i in ld ld.bfd ld.gold; do"
  post "  mv /emul/usr/bin/$i $PLUGDIR/ld/$i"
  post "  cp $WRAPDIR/wrapper-$RUN /emul/usr/bin/$i"
  post "done"
  post "#printf "%s\n%s\n" '#!/bin/bash' 'if [ -f /home/abuild/rpmbuild/SOURCES/linaro-glibc.spec ]; then $0.bfd "$@"; else $0.gold "$@" || $0.bfd "$@"; fi' > /tmp/gccwrap/ld/ld"
  preun "for i in gcc g++ cpp c++; do"
  preun "  mv /emul/usr/bin/$i-real /emul/usr/bin/$i"
  preun "  rm /emul/usr/bin/$TARGET_ARCH-$i-real"
  preun "done"
  preun "rm /emul/usr/bin/cc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xgcc-real"
  preun "rm /emul/home/abuild/rpmbuild/BUILD/gcc-$GCC_VERSION/obj/gcc/xg++-real"
  preun "for i in ld ld.bfd ld.gold; do"
  preun "  mv $PLUGDIR/ld/$i /emul/usr/bin/$i"
  preun "done"

